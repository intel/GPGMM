name: "Auto merge pull requests"

on:
  # Trigger when checks complete.
  # This is manually triggered as final step of CI workflow.
  repository_dispatch:
    types: [checks-complete]

jobs:
  automerge:
    runs-on: ubuntu-latest

    steps:
      - id: automerge
        name: automerge
        uses: "pascalgn/automerge-action@v0.15.3"
        env:
          MERGE_LABELS: "automerge,!work in progress,!wip,!in progress"
          MERGE_REMOVE_LABELS: "automerge,work in progress,wip,in progress"
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          MERGE_METHOD: "squash"
          MERGE_DELETE_BRANCH: true
          UPDATE_METHOD: "rebase"
