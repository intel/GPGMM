<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GPGMM: gpgmm::d3d12::IResourceAllocator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GPGMM
   </div>
   <div id="projectbrief">GPGMM, a General-Purpose GPU Memory Management Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacegpgmm.html">gpgmm</a></li><li class="navelem"><a class="el" href="namespacegpgmm_1_1d3d12.html">d3d12</a></li><li class="navelem"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html">IResourceAllocator</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">gpgmm::d3d12::IResourceAllocator Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div></div>
</div><!--header-->
<div class="contents">

<p>ResourceAllocator is a MemoryAllocator that creates ID3D12Resources in a ResourceAllocation.  
 <a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#details">More...</a></p>

<p><code>#include &lt;gpgmm_d3d12.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for gpgmm::d3d12::IResourceAllocator:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classgpgmm_1_1d3d12_1_1_i_resource_allocator.png" alt=""/>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a51f550ec5771ea10b9be45cc14207937"><td class="memItemLeft" align="right" valign="top">virtual HRESULT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a51f550ec5771ea10b9be45cc14207937">CreateResource</a> (const <a class="el" href="structgpgmm_1_1d3d12_1_1_a_l_l_o_c_a_t_i_o_n___d_e_s_c.html">ALLOCATION_DESC</a> &amp;allocationDescriptor, const D3D12_RESOURCE_DESC &amp;resourceDescriptor, D3D12_RESOURCE_STATES initialResourceState, const D3D12_CLEAR_VALUE *pClearValue, <a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocation.html">IResourceAllocation</a> **ppResourceAllocationOut)=0</td></tr>
<tr class="memdesc:a51f550ec5771ea10b9be45cc14207937"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates memory and creates a D3D12 resource using it.  <a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a51f550ec5771ea10b9be45cc14207937">More...</a><br /></td></tr>
<tr class="separator:a51f550ec5771ea10b9be45cc14207937"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a568d37cfa8ba61dbcca4b3765c50e41e"><td class="memItemLeft" align="right" valign="top">virtual HRESULT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a568d37cfa8ba61dbcca4b3765c50e41e">CreateResource</a> (Microsoft::WRL::ComPtr&lt; ID3D12Resource &gt; committedResource, <a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocation.html">IResourceAllocation</a> **ppResourceAllocationOut)=0</td></tr>
<tr class="memdesc:a568d37cfa8ba61dbcca4b3765c50e41e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Imports an existing D3D12 resource.  <a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a568d37cfa8ba61dbcca4b3765c50e41e">More...</a><br /></td></tr>
<tr class="separator:a568d37cfa8ba61dbcca4b3765c50e41e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d074a6bef62cf5ccd87c79e4cd99386"><td class="memItemLeft" align="right" valign="top">virtual uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a6d074a6bef62cf5ccd87c79e4cd99386">ReleaseMemory</a> (uint64_t bytesToRelease)=0</td></tr>
<tr class="memdesc:a6d074a6bef62cf5ccd87c79e4cd99386"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return free memory back to the OS.  <a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a6d074a6bef62cf5ccd87c79e4cd99386">More...</a><br /></td></tr>
<tr class="separator:a6d074a6bef62cf5ccd87c79e4cd99386"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89d618b87b741446f87184fc1fc4a3a5"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacegpgmm_1_1d3d12.html#ac5918db78a3965f1c32a88a8bdd76b86">RESOURCE_ALLOCATOR_STATS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a89d618b87b741446f87184fc1fc4a3a5">GetStats</a> () const =0</td></tr>
<tr class="memdesc:a89d618b87b741446f87184fc1fc4a3a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the current allocator usage.  <a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a89d618b87b741446f87184fc1fc4a3a5">More...</a><br /></td></tr>
<tr class="separator:a89d618b87b741446f87184fc1fc4a3a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dc27dd2e8023919a721d04ac93a7aa5"><td class="memItemLeft" align="right" valign="top">virtual HRESULT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a9dc27dd2e8023919a721d04ac93a7aa5">CheckFeatureSupport</a> (<a class="el" href="namespacegpgmm_1_1d3d12.html#a24c166248417fa823597d7219566304a">ALLOCATOR_FEATURE</a> feature, void *pFeatureSupportData, uint32_t featureSupportDataSize) const =0</td></tr>
<tr class="memdesc:a9dc27dd2e8023919a721d04ac93a7aa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets information about the features that are supported by the resource allocator.  <a href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a9dc27dd2e8023919a721d04ac93a7aa5">More...</a><br /></td></tr>
<tr class="separator:a9dc27dd2e8023919a721d04ac93a7aa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >ResourceAllocator is a MemoryAllocator that creates ID3D12Resources in a ResourceAllocation. </p>
<p >Internally, ResourceAllocator creates a request, by determining the resource allocation requirements, then finds a MemoryAllocator able to service the request.</p>
<p >If the first MemoryAllocator attempt fails, it will try a second MemoryAllocator, and so on. MemoryAllocator attempts are greedy: re-use of resources &gt; re-use of heaps &gt; re-use by pools &gt; no re-use, in order of maximizing performance while minimizing memory footprint.</p>
<p >ResourceAllocator also uses ResidencyManager to determine available memory (or budget left) when creating the request. This is because residency is managed per heap and not per resource). A larger Heap could be ideal for allocation but only if there is budget. And similarly, a smaller Heap allows for finer grained residency but could increase overall memory usage for allocation. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a9dc27dd2e8023919a721d04ac93a7aa5" name="a9dc27dd2e8023919a721d04ac93a7aa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9dc27dd2e8023919a721d04ac93a7aa5">&#9670;&#160;</a></span>CheckFeatureSupport()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual HRESULT gpgmm::d3d12::IResourceAllocator::CheckFeatureSupport </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacegpgmm_1_1d3d12.html#a24c166248417fa823597d7219566304a">ALLOCATOR_FEATURE</a>&#160;</td>
          <td class="paramname"><em>feature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pFeatureSupportData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>featureSupportDataSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets information about the features that are supported by the resource allocator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">feature</td><td>A constant from the ALLOCATOR_FEATURE enumeration describing the feature(s) that you want to query for support. </td></tr>
    <tr><td class="paramname">pFeatureSupportData</td><td>A pointer to the data structure that corresponds to the value of the feature parameter. To determine the corresponding data structure for each constant, see FEATURE. </td></tr>
    <tr><td class="paramname">featureSupportDataSize</td><td>The sie of the structure pointed by the pFeatureSupportData parameter.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns S_OK if successful. Returns E_INVALIDARG if unsupported data type is passed to pFeatureSupportData or if a size mismatch is detected for the featureSupportDataSize parameter. </dd></dl>

</div>
</div>
<a id="a51f550ec5771ea10b9be45cc14207937" name="a51f550ec5771ea10b9be45cc14207937"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51f550ec5771ea10b9be45cc14207937">&#9670;&#160;</a></span>CreateResource() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual HRESULT gpgmm::d3d12::IResourceAllocator::CreateResource </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgpgmm_1_1d3d12_1_1_a_l_l_o_c_a_t_i_o_n___d_e_s_c.html">ALLOCATION_DESC</a> &amp;&#160;</td>
          <td class="paramname"><em>allocationDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const D3D12_RESOURCE_DESC &amp;&#160;</td>
          <td class="paramname"><em>resourceDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">D3D12_RESOURCE_STATES&#160;</td>
          <td class="paramname"><em>initialResourceState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const D3D12_CLEAR_VALUE *&#160;</td>
          <td class="paramname"><em>pClearValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocation.html">IResourceAllocation</a> **&#160;</td>
          <td class="paramname"><em>ppResourceAllocationOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocates memory and creates a D3D12 resource using it. </p>
<p >Returns a ResourceAllocation which represents a resource allocated at a specific location in memory. The resource could be allocated within a resource heap, within the resource itself, or seperately using it's own memory (resource heap).</p>
<p >Unlike a D3D12 resource, a resource allocation can made resident. It is recommended but not strictly required to use the D3D12 resource equivalent methods (ex. Map, Unmap) through the returned ResourceAllocation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">allocationDescriptor</td><td>A reference to <a class="el" href="structgpgmm_1_1d3d12_1_1_a_l_l_o_c_a_t_i_o_n___d_e_s_c.html">ALLOCATION_DESC</a> structure that provides properties for the resource allocation. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">resourceDescriptor</td><td>A reference to the D3D12_RESOURCE_DESC structure that describes the resource. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">initialResourceState</td><td>The initial state of the resource, a bitwise OR'd combination of D3D12_RESOURCE_STATES enumeration constants. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">pClearValue</td><td>A pointer tp D3D12_CLEAR_VALUE structure that describes the default value for a clear color. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppResourceAllocationOut</td><td>An optional pointer to a memory block that receives the required interface pointer to the created resource allocation object. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a568d37cfa8ba61dbcca4b3765c50e41e" name="a568d37cfa8ba61dbcca4b3765c50e41e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a568d37cfa8ba61dbcca4b3765c50e41e">&#9670;&#160;</a></span>CreateResource() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual HRESULT gpgmm::d3d12::IResourceAllocator::CreateResource </td>
          <td>(</td>
          <td class="paramtype">Microsoft::WRL::ComPtr&lt; ID3D12Resource &gt;&#160;</td>
          <td class="paramname"><em>committedResource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocation.html">IResourceAllocation</a> **&#160;</td>
          <td class="paramname"><em>ppResourceAllocationOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Imports an existing D3D12 resource. </p>
<p >Allows externally created D3D12 resources to be used as ResourceAllocations.</p>
<p >Residency is not supported for imported resources.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">committedResource</td><td>A COM managed pointer to a D3D12 committed resource. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppResourceAllocationOut</td><td>Pointer to a memory block that receives a pointer to the resource allocation. Pass NULL to test if resource allocation creation would succeed, but not actually create the resource allocation. If NULL is passed and resource allocation creation would succeed, S_FALSE is returned. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a89d618b87b741446f87184fc1fc4a3a5" name="a89d618b87b741446f87184fc1fc4a3a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89d618b87b741446f87184fc1fc4a3a5">&#9670;&#160;</a></span>GetStats()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacegpgmm_1_1d3d12.html#ac5918db78a3965f1c32a88a8bdd76b86">RESOURCE_ALLOCATOR_STATS</a> gpgmm::d3d12::IResourceAllocator::GetStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the current allocator usage. </p>
<p >Returned info can be used to monitor memory usage per allocator. For example, the amount of internal fragmentation is equal to UsedBlockUsage / UsedMemoryUsage. Or the percent of recycled memory is equal to FreeMemoryUsage / (UsedMemoryUsage + FreeMemoryUsage) * 100%. </p>

</div>
</div>
<a id="a6d074a6bef62cf5ccd87c79e4cd99386" name="a6d074a6bef62cf5ccd87c79e4cd99386"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d074a6bef62cf5ccd87c79e4cd99386">&#9670;&#160;</a></span>ReleaseMemory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual uint64_t gpgmm::d3d12::IResourceAllocator::ReleaseMemory </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>bytesToRelease</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return free memory back to the OS. </p>
<p >When pooling is enabled, the allocator will retain resource heaps in order to speed-up subsequent resource allocation requests. These resource allocations count against the app's memory usage and in general, will lead to increased memory usage by the overall system. Apps should call <a class="el" href="classgpgmm_1_1d3d12_1_1_i_resource_allocator.html#a6d074a6bef62cf5ccd87c79e4cd99386" title="Return free memory back to the OS.">ReleaseMemory()</a> when going idle for a period of time since there is a brief performance hit when the internal resource heaps get reallocated by the OS.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytesToRelease</td><td>Amount of memory to release, in bytes. A value of UINT64_MAX releases ALL memory held by the allocator.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Amount of memory, in bytes, released. The released size might be smaller then bytesToRelease if there was not enough memory or larger if releasable memory doesn't exactly total up to the amount. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/<a class="el" href="gpgmm__d3d12_8h.html">gpgmm_d3d12.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
